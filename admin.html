<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swami Studio | Admin Panel</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; padding: 20px; color: #333; }
        .container { max-width: 950px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { border-bottom: 2px solid #D4AF37; padding-bottom: 10px; color: #333; margin-top: 0; }
        .section-box { background: #fff; padding: 25px; margin-bottom: 30px; border: 1px solid #e1e4e8; border-radius: 8px; position: relative; }
        label { font-weight: 600; display: block; margin-top: 15px; margin-bottom: 5px; color: #444; }
        input, button, select, textarea { width: 100%; padding: 12px; margin-top: 5px; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; }
        
        /* Mobile Adjustments */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            .section-box { padding: 15px; }
            .flex-group { flex-direction: column !important; gap: 0 !important; }
            .flex-group > div { width: 100%; }
        }

        .url-input { border: 1px dashed #D4AF37; background: #fffdf5; }
        .price-input { border: 2px solid #2ecc71; font-weight: bold; font-size: 1.1em; color: #2ecc71; }
        button { background: #D4AF37; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; font-size: 15px; }
        
        .btn-edit { background: #333; width: auto; padding: 8px 15px; font-size: 13px; margin-right: 5px; margin-top: 5px; }
        .btn-delete { background: #e74c3c; width: auto; padding: 8px 15px; font-size: 13px; margin-top: 5px; }
        .btn-cancel { background: #95a5a6; display: none; margin-left: 10px; width: auto; }

        .project-item { display: flex; align-items: center; background: #f9f9f9; padding: 10px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 6px; flex-wrap: wrap; }
        .project-img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 15px; }
        .project-info { flex: 1; min-width: 150px; }
        .flex-group { display: flex; gap: 20px; }

        #login-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 999; }
        #login-box { background: white; padding: 40px; width: 320px; text-align: center; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="login-modal">
        <div id="login-box">
            <h2>Admin Login</h2>
            <input type="password" id="admin-pass" placeholder="Password">
            <button onclick="checkLogin()">Login</button>
        </div>
    </div>

    <div class="container" id="admin-panel" style="display:none;">
        <h1 style="text-align:center;">Swami Studio Admin</h1>
        <a href="index.html" target="_blank" style="display:block; text-align:center; margin-bottom:30px; color:#666;">View Live Website ‚Üó</a>

        <div class="section-box">
            <h2>‚öôÔ∏è General Settings</h2>
            <label>Website Tagline:</label>
            <input type="text" id="set-tagline" placeholder="e.g. Capturing Moments...">
            <label>Upload Logo:</label>
            <div style="background:#f9f9f9; padding:15px; border-radius:6px;">
                 <input type="file" id="logo-file">
                 <button onclick="uploadLogo()" style="background:#333; margin-top:10px; width:auto;">Upload</button>
                 <input type="text" id="set-logo" class="url-input" placeholder="Logo URL" style="margin-top:10px;">
            </div>
            <button onclick="saveSettings()">Save Settings</button>
        </div>

        <div class="section-box">
            <h2>üìÇ Manage Categories</h2>
            <input type="hidden" id="edit-cat-id">
            <input type="text" id="cat-name" placeholder="Category Name">
            <button onclick="saveCategory()" id="btn-save-cat">‚ûï Add Category</button>
            <button onclick="cancelCatEdit()" id="btn-cancel-cat" class="btn-cancel">Cancel</button>
            <div id="category-list-display" style="margin-top:15px;"></div>
        </div>

        <div class="section-box" id="project-section">
            <h2>üì∏ Project Manager</h2>
            <input type="hidden" id="pf-edit-id">

            <label>1. Title / Client Name:</label>
            <input type="text" id="pf-title" placeholder="e.g. Wedding Package A">

            <div class="flex-group">
                <div style="flex:1;">
                    <label>2. Category:</label>
                    <select id="pf-cat-select"><option value="">Loading...</option></select>
                </div>
                <div style="flex:1;">
                    <label>3. Price (‚Çπ):</label>
                    <input type="number" id="pf-price" class="price-input" placeholder="e.g. 50000">
                </div>
            </div>

            <label>4. Description:</label>
            <textarea id="pf-desc" placeholder="Details about this project..." style="height:60px;"></textarea>

            <label>5. Main Image (Cover):</label>
            <div style="background:#f9f9f9; padding:15px; border-radius:6px;">
                <p style="margin:0 0 5px 0; font-size:0.9em;">Option A: Upload New File</p>
                <input type="file" id="pf-main-img" style="margin-top:0;">
                <p style="margin:10px 0 5px 0; font-size:0.9em; font-weight:bold;">OR</p>
                <p style="margin:0 0 5px 0; font-size:0.9em;">Option B: Image URL</p>
                <input type="text" id="pf-main-url" class="url-input" placeholder="https://..." style="margin-top:0;">
            </div>

            <label>6. Extra Images (Max 10):</label>
            <div style="background:#f9f9f9; padding:15px; border-radius:6px;">
                <p style="margin:0 0 5px 0; font-size:0.9em;">Upload New (Select up to 10)</p>
                <input type="file" id="pf-sub-imgs" multiple style="margin-top:0;">
                <p style="margin:10px 0 5px 0; font-size:0.9em; font-weight:bold;">OR</p>
                <p style="margin:0 0 5px 0; font-size:0.9em;">Image URLs (One per line)</p>
                <textarea id="pf-sub-urls" class="url-input" placeholder="https://..." style="height:80px; margin-top:0;"></textarea>
            </div>

            <label>7. Video:</label>
            <div style="background:#f9f9f9; padding:15px; border-radius:6px;">
                <p style="margin:0 0 5px 0; font-size:0.9em;">Option A: Upload New File</p>
                <input type="file" id="pf-video" accept="video/*" style="margin-top:0;">
                <p style="margin:10px 0 5px 0; font-size:0.9em; font-weight:bold;">OR</p>
                <p style="margin:0 0 5px 0; font-size:0.9em;">Option B: Video URL</p>
                <input type="text" id="pf-video-url" class="url-input" placeholder="https://..." style="margin-top:0;">
            </div>

            <div style="display:flex; align-items:center; flex-wrap:wrap;">
                <button onclick="uploadFullProject()" id="btn-save-proj">üöÄ Upload Project</button>
                <button onclick="cancelProjectEdit()" id="btn-cancel-proj" class="btn-cancel">Cancel Edit</button>
            </div>
            
            <p id="upload-status" style="color:blue; margin-top:10px; font-weight:bold;"></p>

            <hr style="margin-top:30px; border:0; border-top:1px solid #eee;">
            <h3>Manage Existing Projects:</h3>
            <div id="gallery-list-display"><p>Loading projects...</p></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyADXKgZ-y4Oo4BjfGfW7euGLCPp623KE-M",
            authDomain: "swami-studio.firebaseapp.com",
            databaseURL: "https://swami-studio-default-rtdb.firebaseio.com",
            projectId: "swami-studio",
            storageBucket: "swami-studio.firebasestorage.app",
            messagingSenderId: "680267170622",
            appId: "1:680267170622:web:2a489e33c206b72b06e26f",
            measurementId: "G-2K4X9057XG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        // PASSWORD UPDATED HERE
        window.checkLogin = function() {
            if(document.getElementById('admin-pass').value === "swami1997") {
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else { alert("Wrong Password"); }
        }

        // 1. SETTINGS
        window.uploadLogo = function() {
            const file = document.getElementById('logo-file').files[0];
            if(!file) return alert("Select logo file");
            const storageRef = sRef(storage, 'logos/' + Date.now() + '_' + file.name);
            uploadBytes(storageRef, file).then(snap => {
                getDownloadURL(snap.ref).then(url => {
                    document.getElementById('set-logo').value = url;
                    alert("Logo Uploaded!");
                });
            });
        }
        window.saveSettings = function() {
            set(ref(db, 'settings'), {
                tagline: document.getElementById('set-tagline').value,
                logoUrl: document.getElementById('set-logo').value
            }).then(() => alert("Settings Saved!"));
        }
        onValue(ref(db, 'settings'), (snap) => {
            const d = snap.val();
            if(d) {
                document.getElementById('set-tagline').value = d.tagline || "";
                document.getElementById('set-logo').value = d.logoUrl || "";
            }
        });

        // 2. CATEGORIES (Description Logic Removed)
        window.saveCategory = function() {
            const id = document.getElementById('edit-cat-id').value;
            const name = document.getElementById('cat-name').value;
            if(!name) return alert("Name required");
            if(id) update(ref(db, 'categories/'+id), { name }).then(()=>cancelCatEdit());
            else push(ref(db, 'categories'), { name }).then(()=>cancelCatEdit());
        }
        window.editCategory = function(id, name) {
            document.getElementById('edit-cat-id').value = id;
            document.getElementById('cat-name').value = name;
            document.getElementById('btn-save-cat').innerText = "Update";
            document.getElementById('btn-cancel-cat').style.display = "inline-block";
        }
        window.cancelCatEdit = function() {
            document.getElementById('edit-cat-id').value = "";
            document.getElementById('cat-name').value = "";
            document.getElementById('btn-save-cat').innerText = "‚ûï Add Category";
            document.getElementById('btn-cancel-cat').style.display = "none";
        }
        onValue(ref(db, 'categories'), (snap) => {
            const div = document.getElementById('category-list-display');
            const sel = document.getElementById('pf-cat-select');
            div.innerHTML = ""; sel.innerHTML = "<option value=''>Select Category...</option>";
            if(snap.exists()) snap.forEach(c => {
                div.innerHTML += `<div style="background:#eee; padding:8px; margin-bottom:5px; display:flex; justify-content:space-between;"><span><strong>${c.val().name}</strong></span><span><button class="btn-edit" onclick='editCategory("${c.key}", "${c.val().name}")'>Edit</button><button class="btn-delete" onclick="remove(ref(db,'categories/${c.key}'))">X</button></span></div>`;
                sel.innerHTML += `<option value="${c.val().name}">${c.val().name}</option>`;
            });
        });

        // 3. PROJECTS (Description Added)
        window.uploadFullProject = async function() {
            const status = document.getElementById('upload-status');
            const editId = document.getElementById('pf-edit-id').value; 
            const title = document.getElementById('pf-title').value;
            const category = document.getElementById('pf-cat-select').value;
            const price = document.getElementById('pf-price').value; 
            const desc = document.getElementById('pf-desc').value; // Get Description
            
            const mainFile = document.getElementById('pf-main-img').files[0];
            const subFiles = document.getElementById('pf-sub-imgs').files;
            const videoFile = document.getElementById('pf-video').files[0];
            
            let mainUrl = document.getElementById('pf-main-url').value;
            const subUrlsText = document.getElementById('pf-sub-urls').value;
            let videoUrl = document.getElementById('pf-video-url').value;

            if(!title || !price || !category) return alert("Title, Price & Category required!");
            if(!mainFile && !mainUrl) return alert("Main Image required!");

            status.innerText = "‚è≥ Processing...";

            try {
                if(mainFile) {
                    status.innerText = "Uploading Main Image...";
                    const snap = await uploadBytes(sRef(storage, 'projects/'+mainFile.name), mainFile);
                    mainUrl = await getDownloadURL(snap.ref);
                }

                let subUrls = [];
                if(subUrlsText.trim()) subUrls = subUrlsText.split('\n').filter(u => u.trim() !== '');
                
                if(subFiles.length > 0) {
                    status.innerText = "Uploading Extra Images...";
                    for(let i=0; i<subFiles.length && i<10; i++) {
                        const snap = await uploadBytes(sRef(storage, 'projects/'+subFiles[i].name), subFiles[i]);
                        subUrls.push(await getDownloadURL(snap.ref));
                    }
                }

                if(videoFile) {
                    status.innerText = "Uploading Video...";
                    const snap = await uploadBytes(sRef(storage, 'projects/'+videoFile.name), videoFile);
                    videoUrl = await getDownloadURL(snap.ref);
                }

                status.innerText = "Saving...";
                // Include Description in Data
                const projectData = { title, category, price, description: desc, mainImage: mainUrl, subImages: subUrls, video: videoUrl, timestamp: Date.now() };

                if(editId) {
                    await update(ref(db, 'gallery/' + editId), projectData);
                    alert("Project Updated!");
                    cancelProjectEdit();
                } else {
                    await push(ref(db, 'gallery'), projectData);
                    alert("Project Added!");
                    cancelProjectEdit();
                }
                status.innerText = "‚úÖ Done!";

            } catch(err) { status.innerText = "Error: " + err.message; }
        }

        window.editProject = function(id, title, category, price, desc, mainImg, subImgsStr, video) {
            document.getElementById('pf-edit-id').value = id;
            document.getElementById('pf-title').value = title;
            document.getElementById('pf-cat-select').value = category;
            document.getElementById('pf-price').value = price;
            document.getElementById('pf-desc').value = desc; // Set Description
            document.getElementById('pf-main-url').value = mainImg;
            document.getElementById('pf-sub-urls').value = subImgsStr.replace(/,/g, '\n');
            document.getElementById('pf-video-url').value = video;

            document.getElementById('btn-save-proj').innerText = "üíæ Update Project";
            document.getElementById('btn-cancel-proj').style.display = "inline-block";
            document.getElementById('project-section').scrollIntoView({ behavior: 'smooth' });
        }

        window.cancelProjectEdit = function() {
            document.getElementById('pf-edit-id').value = "";
            document.getElementById('pf-title').value = "";
            document.getElementById('pf-price').value = "";
            document.getElementById('pf-desc').value = ""; // Clear Description
            document.getElementById('pf-main-url').value = "";
            document.getElementById('pf-sub-urls').value = "";
            document.getElementById('pf-video-url').value = "";
            document.getElementById('pf-main-img').value = ""; 
            document.getElementById('pf-sub-imgs').value = "";
            document.getElementById('pf-video').value = "";

            document.getElementById('btn-save-proj').innerText = "üöÄ Upload Project";
            document.getElementById('btn-cancel-proj').style.display = "none";
        }

        onValue(ref(db, 'gallery'), (snap) => {
            const listDiv = document.getElementById('gallery-list-display');
            listDiv.innerHTML = "";
            if(snap.exists()) {
                snap.forEach(child => {
                    const p = child.val();
                    const key = child.key;
                    const sTitle = p.title.replace(/'/g, "\\'");
                    const sDesc = p.description ? p.description.replace(/"/g, '&quot;').replace(/'/g, "\\'") : "";
                    const sSub = p.subImages ? p.subImages.join(',') : "";
                    
                    listDiv.innerHTML += `
                        <div class="project-item">
                            <img src="${p.mainImage}" class="project-img">
                            <div class="project-info">
                                <strong>${p.title}</strong><br>
                                <span class="project-price">‚Çπ${p.price}</span> | <small>${p.category}</small>
                            </div>
                            <button class="btn-edit" onclick="editProject('${key}', '${sTitle}', '${p.category}', '${p.price}', '${sDesc}', '${p.mainImage}', '${sSub}', '${p.video||""}')">Edit</button>
                            <button class="btn-delete" onclick="remove(ref(db, 'gallery/${key}'))">Delete</button>
                        </div>
                    `;
                });
            } else { listDiv.innerHTML = "<p>No projects uploaded.</p>"; }
        });
        
        window.remove = remove; window.ref = ref; window.db = db;
    </script>
</body>
</html>
