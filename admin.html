<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Swami Studio</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f6f9; padding: 20px; color: #333; }
        
        .container { max-width: 850px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        
        h1 { text-align: center; color: #222; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #777; margin-bottom: 30px; display: block; text-decoration: none;}
        
        h2 { border-bottom: 2px solid #D4AF37; padding-bottom: 10px; color: #333; margin-top: 0; }
        
        .section-box { background: #fff; padding: 20px; margin-bottom: 25px; border: 1px solid #e1e4e8; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        
        label { font-weight: 600; display: block; margin-top: 15px; margin-bottom: 5px; color: #555; }
        input, button, select, textarea { width: 100%; padding: 12px; margin-top: 5px; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
        
        button { background: #D4AF37; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.3s; }
        button:hover { background: #b59228; }
        
        /* Specific Button Styles */
        .upload-btn { background: #333; }
        .upload-btn:hover { background: #555; }
        
        .delete-btn { background: #ff4444; color: white; border: none; padding: 8px; margin-top: 5px; width: auto; float: right; cursor: pointer; border-radius: 4px; }
        .delete-btn:hover { background: #cc0000; }

        .booking-item { background: #f9f9f9; padding: 15px; border-bottom: 1px solid #eee; margin-bottom: 10px; border-radius: 6px; overflow: hidden; }

        /* Login Modal */
        #login-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        #login-box { background: white; padding: 40px; text-align: center; border-radius: 10px; width: 320px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div id="login-modal">
        <div id="login-box">
            <h2 style="border:none;">Admin Login</h2>
            <p style="color:#666; margin-bottom:20px;">Swami Studio Control Panel</p>
            <input type="password" id="admin-pass" placeholder="Enter Password">
            <button onclick="checkLogin()">Access Dashboard</button>
        </div>
    </div>

    <div class="container" id="admin-panel" style="display:none;">
        <h1>Swami Studio Admin üõ†Ô∏è</h1>
        <a href="index.html" target="_blank" class="subtitle">View Live Website (index.html)</a>

        <div class="section-box">
            <h2>‚öôÔ∏è General Settings & Logo</h2>
            
            <label>Website Tagline:</label>
            <input type="text" id="set-tagline" placeholder="e.g. Your Moments, Framed with Perfection.">
            
            <label>Current Theme:</label>
            <select id="set-theme">
                <option value="Standard">Standard (Black & Gold)</option>
                <option value="Diwali">Diwali Festival üéÜ</option>
            </select>

            <label><strong>Upload Logo (Appears next to Name):</strong></label>
            <div style="display:flex; gap:10px;">
                <input type="file" id="logo-file">
                <button class="upload-btn" style="width: 40%; margin-top:5px;" onclick="uploadLogo()">Upload Logo</button>
            </div>
            <p id="logo-status" style="color:blue; font-size:0.9em; margin-top:5px;"></p>

            <label>Logo URL (Auto-filled):</label>
            <input type="text" id="set-logo" placeholder="Logo link will appear here..." readonly>

            <button onclick="saveSettings()">Save All Settings</button>
        </div>

        <div class="section-box">
            <h2>üì∏ Gallery Manager</h2>
            <p style="color:#666; margin-top:0;">Add photos to your "Latest Work" section.</p>
            <input type="file" id="photo-file">
            <button class="upload-btn" onclick="uploadPhoto()">Upload & Add to Gallery</button>
            <p id="upload-status" style="color:blue;"></p>
        </div>

        <div class="section-box">
            <h2>üìù Add Service</h2>
            <div style="display:flex; gap:10px;">
                <input type="text" id="serv-name" placeholder="Service Name (e.g. Baby Shoot)" style="flex:2;">
                <input type="number" id="serv-price" placeholder="Price (‚Çπ)" style="flex:1;">
            </div>
            <button onclick="addService()">Add Service</button>
        </div>

         <div class="section-box">
            <h2>‚≠ê Add Review</h2>
            <input type="text" id="test-client" placeholder="Client Name">
            <textarea id="test-msg" placeholder="What did they say about the service?" style="height: 80px;"></textarea>
            <button onclick="addTestimonial()">Add Review</button>
        </div>

        <div class="section-box">
            <h2>üìÖ Client Bookings</h2>
            <div id="bookings-list">
                <p>Loading bookings...</p>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // --- YOUR SWAMI STUDIO CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyADXKgZ-y4Oo4BjfGfW7euGLCPp623KE-M",
            authDomain: "swami-studio.firebaseapp.com",
            databaseURL: "https://swami-studio-default-rtdb.firebaseio.com",
            projectId: "swami-studio",
            storageBucket: "swami-studio.firebasestorage.app",
            messagingSenderId: "680267170622",
            appId: "1:680267170622:web:2a489e33c206b72b06e26f",
            measurementId: "G-2K4X9057XG"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        // --- 1. ADMIN LOGIN ---
        window.checkLogin = function() {
            const pass = document.getElementById('admin-pass').value;
            // Default Password is 'admin123' - Change this if you want
            if(pass === "admin123") { 
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else {
                alert("Incorrect Password!");
            }
        }

        // --- 2. SAVE SETTINGS (Tagline, Theme, Logo URL) ---
        window.saveSettings = function() {
            set(ref(db, 'settings'), {
                tagline: document.getElementById('set-tagline').value,
                theme: document.getElementById('set-theme').value,
                logoUrl: document.getElementById('set-logo').value
            }).then(() => {
                alert("‚úÖ Settings Saved! Refresh index.html to see changes.");
            }).catch((error) => {
                alert("‚ùå Error: " + error.message);
            });
        }

        // --- 3. UPLOAD LOGO FUNCTION ---
        window.uploadLogo = function() {
            const file = document.getElementById('logo-file').files[0];
            if(!file) return alert("Please select a logo file first.");

            const status = document.getElementById('logo-status');
            status.innerText = "Uploading logo... Please wait.";

            const storageRef = sRef(storage, 'logos/' + file.name);
            uploadBytes(storageRef, file).then((snapshot) => {
                getDownloadURL(snapshot.ref).then((url) => {
                    document.getElementById('set-logo').value = url;
                    status.innerText = "‚úÖ Logo Uploaded! Click 'Save All Settings' to apply.";
                });
            }).catch((error) => {
                status.innerText = "‚ùå Upload Failed: " + error.message;
            });
        }

        // --- 4. UPLOAD GALLERY PHOTO ---
        window.uploadPhoto = function() {
            const file = document.getElementById('photo-file').files[0];
            if(!file) return alert("Select a photo first.");
            
            const status = document.getElementById('upload-status');
            status.innerText = "Uploading... Please wait.";

            const storageRef = sRef(storage, 'gallery/' + file.name);
            uploadBytes(storageRef, file).then((snapshot) => {
                getDownloadURL(snapshot.ref).then((url) => {
                    push(ref(db, 'gallery'), { url: url });
                    status.innerText = "‚úÖ Photo Added to Gallery!";
                });
            }).catch((error) => {
                status.innerText = "‚ùå Error: " + error.message;
            });
        }

        // --- 5. ADD SERVICE ---
        window.addService = function() {
            const name = document.getElementById('serv-name').value;
            const price = document.getElementById('serv-price').value;
            if(name && price) {
                push(ref(db, 'services'), { name: name, price: price });
                alert("Service Added Successfully!");
                document.getElementById('serv-name').value = "";
                document.getElementById('serv-price').value = "";
            } else {
                alert("Please fill in both Name and Price.");
            }
        }

        // --- 6. ADD TESTIMONIAL ---
        window.addTestimonial = function() {
            const client = document.getElementById('test-client').value;
            const msg = document.getElementById('test-msg').value;
            if(client && msg) {
                push(ref(db, 'testimonials'), { client: client, msg: msg });
                alert("Review Added!");
                document.getElementById('test-client').value = "";
                document.getElementById('test-msg').value = "";
            }
        }

        // --- 7. DELETE BOOKING ---
        window.deleteBooking = function(id) {
            if(confirm("Are you sure you want to delete this booking?")) {
                remove(ref(db, 'bookings/' + id));
            }
        }

        // --- LOAD DATA ON START ---
        // Load Settings
        onValue(ref(db, 'settings'), (snap) => {
            const data = snap.val();
            if(data) {
                document.getElementById('set-tagline').value = data.tagline || "";
                document.getElementById('set-theme').value = data.theme || "Standard";
                document.getElementById('set-logo').value = data.logoUrl || "";
            }
        });

        // Load Bookings Live
        onValue(ref(db, 'bookings'), (snap) => {
            const list = document.getElementById('bookings-list');
            list.innerHTML = "";
            if(snap.exists()) {
                snap.forEach((child) => {
                    const b = child.val();
                    const key = child.key;
                    list.innerHTML += `
                        <div class="booking-item">
                            <button class="delete-btn" onclick="deleteBooking('${key}')">Remove</button>
                            <strong>${b.name}</strong> <span style="color:#777;">(${b.type})</span><br>
                            Phone: ${b.phone} | Date: ${b.date}<br>
                        </div>`;
                });
            } else {
                list.innerHTML = "<p style='text-align:center; color:#999;'>No bookings yet.</p>";
            }
        });
    </script>
</body>
</html>
