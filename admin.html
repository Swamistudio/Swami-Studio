<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swami Studio | Admin Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h1 { text-align: center; color: #222; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; display: block; text-decoration: none; margin-bottom: 30px;}
        
        h2 { border-bottom: 2px solid #D4AF37; padding-bottom: 10px; color: #333; margin-top: 0; }
        .section-box { background: #fff; padding: 25px; margin-bottom: 25px; border: 1px solid #e1e4e8; border-radius: 8px; }
        
        label { font-weight: 600; display: block; margin-top: 15px; margin-bottom: 5px; color: #444; }
        input, button, select, textarea { width: 100%; padding: 12px; margin-top: 5px; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; }
        
        button { background: #D4AF37; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; font-size: 16px; }
        button:hover { background: #b59228; }
        .upload-btn { background: #333; }
        .delete-btn { background: #ff4444; width: auto; padding: 8px 15px; float: right; font-size: 14px; margin-top: 0; }
        
        /* Item Lists */
        .list-item { background: #f8f9fa; padding: 15px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .list-img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 15px; }
        .list-info { flex-grow: 1; }

        /* Login Modal */
        #login-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 999; }
        #login-box { background: white; padding: 40px; width: 320px; text-align: center; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="login-modal">
        <div id="login-box">
            <h2>Admin Login</h2>
            <p>Swami Studio Dashboard</p>
            <input type="password" id="admin-pass" placeholder="Password">
            <button onclick="checkLogin()">Login</button>
        </div>
    </div>

    <div class="container" id="admin-panel" style="display:none;">
        <h1>Swami Studio Admin</h1>
        <a href="index.html" target="_blank" class="subtitle">View Live Website ‚Üó</a>

        <div class="section-box">
            <h2>‚öôÔ∏è Site Settings</h2>
            <label>Tagline (Hero Text):</label>
            <input type="text" id="set-tagline" placeholder="e.g. Capturing Moments...">
            
            <label>Theme:</label>
            <select id="set-theme">
                <option value="Standard">Standard (Black & Gold)</option>
                <option value="Diwali">Diwali Theme üéÜ</option>
            </select>

            <label>Site Logo:</label>
            <div style="display:flex; gap:10px;">
                <input type="file" id="logo-file">
                <button class="upload-btn" onclick="uploadLogo()" style="margin-top:5px; width: 40%;">Upload Logo</button>
            </div>
            <input type="text" id="set-logo" readonly placeholder="Logo URL will appear here...">
            
            <button onclick="saveSettings()">Save General Settings</button>
        </div>

        <div class="section-box">
            <h2>üì∏ Add Portfolio Item</h2>
            <p style="color:#666; margin-top:0;">Upload new work to your gallery.</p>
            
            <label>1. Select Image:</label>
            <input type="file" id="pf-file">

            <label>2. Category:</label>
            <select id="pf-cat">
                <option value="Wedding">Wedding Photography</option>
                <option value="Pre-Wedding">Pre-Wedding</option>
                <option value="Events">Events / Functions</option>
                <option value="Product">Product Shoot</option>
                <option value="Fashion">Fashion / Model</option>
            </select>

            <label>3. Short Description:</label>
            <input type="text" id="pf-desc" placeholder="e.g. Beautiful destination wedding in Goa">

            <button class="upload-btn" onclick="uploadPortfolioItem()">Upload & Add Item</button>
            <p id="pf-status" style="color:blue; margin-top:10px;"></p>
        </div>

        <div class="section-box">
            <h2>üìù Services & Pricing</h2>
            <div style="display:flex; gap:10px;">
                <input type="text" id="serv-name" placeholder="Service Name (e.g. Drone)" style="flex:2">
                <input type="number" id="serv-price" placeholder="Price (‚Çπ)" style="flex:1">
            </div>
            <button onclick="addService()">Add Service</button>
            
            <div id="services-list" style="margin-top:20px;"></div>
        </div>

        <div class="section-box">
            <h2>‚≠ê Client Reviews</h2>
            <input type="text" id="test-client" placeholder="Client Name">
            <textarea id="test-msg" placeholder="Review message..." style="height:80px;"></textarea>
            <button onclick="addTestimonial()">Add Review</button>
        </div>

        <div class="section-box">
            <h2>üìÖ New Bookings</h2>
            <div id="bookings-list">Loading...</div>
        </div>
    </div>

    <script type="module">
        // Using CDN links because browsers cannot read "firebase/app" directly without a bundler
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // YOUR CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyADXKgZ-y4Oo4BjfGfW7euGLCPp623KE-M",
            authDomain: "swami-studio.firebaseapp.com",
            databaseURL: "https://swami-studio-default-rtdb.firebaseio.com",
            projectId: "swami-studio",
            storageBucket: "swami-studio.firebasestorage.app",
            messagingSenderId: "680267170622",
            appId: "1:680267170622:web:2a489e33c206b72b06e26f",
            measurementId: "G-2K4X9057XG"
        };

        // Initialize
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);
        // Analytics is optional for Admin panel, but initialized as requested
        const analytics = getAnalytics(app); 

        // --- AUTH ---
        window.checkLogin = function() {
            if(document.getElementById('admin-pass').value === "admin123") {
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else { alert("Wrong Password"); }
        }

        // --- GENERAL SETTINGS ---
        window.saveSettings = function() {
            set(ref(db, 'settings'), {
                tagline: document.getElementById('set-tagline').value,
                theme: document.getElementById('set-theme').value,
                logoUrl: document.getElementById('set-logo').value
            }).then(() => alert("Settings Saved!"));
        }

        window.uploadLogo = function() {
            const file = document.getElementById('logo-file').files[0];
            if(!file) return alert("Select logo file");
            const storageRef = sRef(storage, 'logos/' + file.name);
            uploadBytes(storageRef, file).then(snap => {
                getDownloadURL(snap.ref).then(url => {
                    document.getElementById('set-logo').value = url;
                    alert("Logo Uploaded. Now Click 'Save General Settings'");
                });
            });
        }

        // --- PORTFOLIO MANAGER (With Category & Description) ---
        window.uploadPortfolioItem = function() {
            const file = document.getElementById('pf-file').files[0];
            const category = document.getElementById('pf-cat').value;
            const desc = document.getElementById('pf-desc').value;

            if(!file) return alert("Please select an image");

            const status = document.getElementById('pf-status');
            status.innerText = "Uploading... please wait";

            const storageRef = sRef(storage, 'gallery/' + file.name);
            uploadBytes(storageRef, file).then((snapshot) => {
                getDownloadURL(snapshot.ref).then((url) => {
                    // Push data with Category and Description
                    push(ref(db, 'gallery'), {
                        url: url,
                        category: category,
                        description: desc
                    });
                    status.innerText = "‚úÖ Item Added Successfully!";
                    // Clear inputs
                    document.getElementById('pf-desc').value = "";
                    document.getElementById('pf-file').value = "";
                });
            }).catch(err => {
                status.innerText = "Error: " + err.message;
            });
        }

        // --- SERVICES ---
        window.addService = function() {
            const name = document.getElementById('serv-name').value;
            const price = document.getElementById('serv-price').value;
            if(name && price) {
                push(ref(db, 'services'), { name, price });
                alert("Service Added");
            }
        }
        
        // Load services to show list (and allow delete)
        onValue(ref(db, 'services'), (snap) => {
            const list = document.getElementById('services-list');
            list.innerHTML = "";
            if(snap.exists()) {
                snap.forEach(child => {
                    list.innerHTML += `
                    <div class="list-item">
                        <span>${child.val().name} - ‚Çπ${child.val().price}</span>
                        <button class="delete-btn" onclick="deleteService('${child.key}')">X</button>
                    </div>`;
                });
            }
        });
        window.deleteService = (id) => remove(ref(db, 'services/' + id));

        // --- TESTIMONIALS ---
        window.addTestimonial = function() {
            const client = document.getElementById('test-client').value;
            const msg = document.getElementById('test-msg').value;
            if(client && msg) {
                push(ref(db, 'testimonials'), { client, msg });
                alert("Testimonial Added");
            }
        }

        // --- BOOKINGS ---
        window.deleteBooking = (id) => { if(confirm("Delete?")) remove(ref(db, 'bookings/'+id)); }

        onValue(ref(db, 'bookings'), (snap) => {
            const list = document.getElementById('bookings-list');
            list.innerHTML = "";
            if(snap.exists()){
                snap.forEach(child => {
                    const b = child.val();
                    list.innerHTML += `
                    <div class="list-item">
                        <div>
                            <strong>${b.name}</strong> (${b.type})<br>
                            <small>${b.date} | ${b.phone}</small>
                        </div>
                        <button class="delete-btn" onclick="deleteBooking('${child.key}')">Delete</button>
                    </div>`;
                });
            } else { list.innerHTML = "No bookings yet."; }
        });

        // Load Settings on Start
        onValue(ref(db, 'settings'), (snap) => {
            const d = snap.val();
            if(d) {
                document.getElementById('set-tagline').value = d.tagline || "";
                document.getElementById('set-theme').value = d.theme || "Standard";
                document.getElementById('set-logo').value = d.logoUrl || "";
            }
        });

    </script>
</body>
</html>
