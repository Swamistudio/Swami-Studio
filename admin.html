<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swami Studio - Admin Control</title>
    <style>
        body { background-color: #f4f4f4; font-family: 'Segoe UI', sans-serif; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 3px solid #FF9900; display: inline-block; padding-bottom: 5px; }
        h2 { margin-top: 30px; color: #555; font-size: 1.2rem; background: #eee; padding: 10px; border-radius: 5px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        input:focus { border-color: #FF9900; outline: none; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* BUTTONS */
        .main-btn { background-color: #FF9900; color: white; border: none; padding: 15px; font-size: 1.1rem; cursor: pointer; width: 100%; font-weight: bold; border-radius: 6px; transition: 0.3s; }
        .main-btn:hover { background-color: #cc7a00; }
        .update-btn { background-color: #007bff; } .update-btn:hover { background-color: #0056b3; }
        .cancel-btn { background-color: #666; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; display: none; margin-top: 10px; width: 100%; }
        
        /* LISTS */
        .list-item { background: #fff; border-bottom: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .action-btns { display: flex; gap: 10px; }
        
        /* DELETE BUTTON STYLE */
        .delete-btn { 
            background: #ff4444; 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            cursor: pointer; 
            border-radius: 4px;
            font-weight: bold;
        }
        .delete-btn:hover { background: #cc0000; }

        .edit-btn { background: #007bff; color: white; border:none; padding: 8px 15px; cursor:pointer; border-radius:4px; font-weight: bold;}

        /* LOGIN SCREEN STYLE */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #222; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        .login-box { background: white; padding: 40px; border-radius: 10px; text-align: center; width: 300px; }
        .login-box input { margin-bottom: 15px; text-align: center; font-size: 1.2rem; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h3 style="margin-bottom:20px;">Admin Login</h3>
        <input type="password" id="adminPass" placeholder="Enter Password">
        <button class="main-btn" onclick="checkLogin()">Unlock</button>
    </div>
</div>

<div class="container">
    <h1>Swami Studio Admin</h1>

    <h2>1. Website Branding</h2>
    <div class="grid-inputs">
        <div class="form-group"><label>Logo Image URL</label><input type="text" id="siteLogo" placeholder="Logo URL"></div>
        <div class="form-group"><label>About Us Background URL</label><input type="text" id="aboutBg" placeholder="Background Image URL"></div>
    </div>
    <button class="main-btn" onclick="saveBranding()" style="background:#333;">Update Branding</button>

    <h2 id="catFormTitle">2. Manage Categories</h2>
    
    <div id="categoryListContainer" style="margin-bottom: 20px; background: #fafafa; padding: 15px; border-radius: 8px; border: 1px solid #ddd;"></div>

    <div class="grid-inputs">
        <div class="form-group">
            <label>Category Name</label>
            <input type="text" id="catName" placeholder="e.g. Wedding">
        </div>
        <div class="form-group">
            <label>Short Description</label>
            <input type="text" id="catDesc" placeholder="e.g. Best moments of your life">
        </div>
    </div>
    <button id="catSubmitBtn" class="main-btn" onclick="handleCategorySubmit()">+ Add Category</button>
    <button id="catCancelBtn" class="cancel-btn" onclick="cancelCatEdit()">Cancel Edit</button>

    <h2 id="formTitle">3. Add New Package / Album</h2>
    <div class="form-group"><label>Select Category</label><select id="category"></select></div>
    <div class="form-group"><label>Package Title (Sub-Category)</label><input type="text" id="title" placeholder="e.g. Rohan & Priya Wedding / Gold Package"></div>
    <div class="form-group"><label>Price (₹)</label><input type="number" id="price" placeholder="e.g. 25000"></div>
    <div class="form-group"><label>Description</label><textarea id="desc" rows="3" placeholder="Details about this package..."></textarea></div>

    <div style="background: #fff8e1; padding: 15px; border-radius: 8px; border: 1px solid #ffe0b2; margin-bottom: 20px;">
        <label style="color: #FF9900;">Step 4: Upload Media (URLs)</label>
        <div class="form-group"><label>Main Cover Image (Required)</label><input type="text" id="imgMain" placeholder="Main thumbnail image URL"></div>
        <div class="grid-inputs">
            <div><label>Extra 1</label><input type="text" class="extra-img" id="ex1" placeholder="Optional"></div>
            <div><label>Extra 2</label><input type="text" class="extra-img" id="ex2" placeholder="Optional"></div>
            <div><label>Extra 3</label><input type="text" class="extra-img" id="ex3" placeholder="Optional"></div>
            <div><label>Extra 4</label><input type="text" class="extra-img" id="ex4" placeholder="Optional"></div>
            <div><label>Extra 5</label><input type="text" class="extra-img" id="ex5" placeholder="Optional"></div>
            <div><label>Video URL</label><input type="text" id="vidUrl" placeholder="Optional Video Link"></div>
        </div>
    </div>

    <button id="submitBtn" class="main-btn" onclick="handlePackageSubmit()">PUBLISH PACKAGE</button>
    <button id="cancelBtn" class="cancel-btn" onclick="cancelEdit()">CANCEL EDIT</button>

    <h2>Manage Current Packages</h2>
    <div id="listContainer"></div>
</div>

<script>
    let packageEditIndex = -1;
    let catEditIndex = -1;

    // --- SECURITY CHECK ---
    function checkLogin() {
        const pass = document.getElementById('adminPass').value;
        if(pass === '8369910171') {
            document.getElementById('loginOverlay').style.display = 'none';
            sessionStorage.setItem('swamiAdminAuth', 'true');
        } else { alert('Incorrect Password!'); }
    }

    // --- BRANDING ---
    function saveBranding() {
        const logo = document.getElementById('siteLogo').value;
        const about = document.getElementById('aboutBg').value;
        if(logo) localStorage.setItem('swamiLogo', logo);
        if(about) localStorage.setItem('swamiAboutBg', about);
        alert("Branding Updated Successfully!");
    }

    // --- CATEGORIES LOGIC ---
    function loadCategories() {
        let cats = JSON.parse(localStorage.getItem('swamiCategories'));
        
        // MIGRATION: Handle old data format
        if (!cats) { 
            cats = [{name:'Wedding', desc:''}, {name:'Pre-Wedding', desc:''}]; 
            localStorage.setItem('swamiCategories', JSON.stringify(cats));
        } else if (cats.length > 0 && typeof cats[0] === 'string') {
            cats = cats.map(c => ({ name: c, desc: '' }));
            localStorage.setItem('swamiCategories', JSON.stringify(cats));
        }

        // 1. Populate Dropdown
        const select = document.getElementById('category'); 
        select.innerHTML = '';
        cats.forEach(c => { 
            let opt = document.createElement('option'); 
            opt.value = c.name; 
            opt.innerHTML = c.name; 
            select.appendChild(opt); 
        });

        // 2. Populate List with DELETE button
        const list = document.getElementById('categoryListContainer');
        list.innerHTML = '';
        if(cats.length === 0) {
            list.innerHTML = "No categories found.";
        }
        
        cats.forEach((c, index) => {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.style.borderBottom = "1px solid #ddd";
            div.innerHTML = `
                <div>
                    <strong>${c.name}</strong><br>
                    <small style="color:#666">${c.desc || 'No description'}</small>
                </div>
                <div class="action-btns">
                    <button class="edit-btn" onclick="editCategory(${index})">Edit</button>
                    <button class="delete-btn" onclick="deleteCategory(${index})">Delete</button>
                </div>
            `;
            list.appendChild(div);
        });

        // Load Branding Inputs
        const savedLogo = localStorage.getItem('swamiLogo'); 
        const savedAbout = localStorage.getItem('swamiAboutBg');
        if(savedLogo) document.getElementById('siteLogo').value = savedLogo;
        if(savedAbout) document.getElementById('aboutBg').value = savedAbout;
    }

    function handleCategorySubmit() {
        const name = document.getElementById('catName').value.trim();
        const desc = document.getElementById('catDesc').value.trim();
        if(!name) return alert("Category Name is required");

        let cats = JSON.parse(localStorage.getItem('swamiCategories')) || [];

        if(catEditIndex === -1) {
            // Add New
            if(cats.some(c => c.name === name)) return alert("Category already exists!");
            cats.push({ name: name, desc: desc });
            alert("Category Added!");
        } else {
            // Update Existing
            cats[catEditIndex] = { name: name, desc: desc };
            alert("Category Updated!");
            cancelCatEdit();
        }

        localStorage.setItem('swamiCategories', JSON.stringify(cats));
        loadCategories();
        document.getElementById('catName').value = '';
        document.getElementById('catDesc').value = '';
    }

    function editCategory(index) {
        let cats = JSON.parse(localStorage.getItem('swamiCategories'));
        catEditIndex = index;
        document.getElementById('catName').value = cats[index].name;
        document.getElementById('catDesc').value = cats[index].desc;
        
        document.getElementById('catSubmitBtn').innerText = "Update Category";
        document.getElementById('catSubmitBtn').classList.add('update-btn');
        document.getElementById('catCancelBtn').style.display = "block";
        document.getElementById('catFormTitle').style.color = "#007bff";
    }

    function deleteCategory(index) {
        if(confirm("Are you sure you want to DELETE this category?")) {
            let cats = JSON.parse(localStorage.getItem('swamiCategories'));
            cats.splice(index, 1);
            localStorage.setItem('swamiCategories', JSON.stringify(cats));
            loadCategories();
            if(index === catEditIndex) cancelCatEdit();
        }
    }

    function cancelCatEdit() {
        catEditIndex = -1;
        document.getElementById('catName').value = '';
        document.getElementById('catDesc').value = '';
        document.getElementById('catSubmitBtn').innerText = "+ Add Category";
        document.getElementById('catSubmitBtn').classList.remove('update-btn');
        document.getElementById('catCancelBtn').style.display = "none";
        document.getElementById('catFormTitle').style.color = "#555";
    }


    // --- PACKAGES LOGIC ---
    function handlePackageSubmit() {
        const extras = []; document.querySelectorAll('.extra-img').forEach(input => { if(input.value.trim()) extras.push(input.value.trim()); });
        const newItem = { id: Date.now(), category: document.getElementById('category').value, title: document.getElementById('title').value, price: document.getElementById('price').value, desc: document.getElementById('desc').value, mainImg: document.getElementById('imgMain').value, extraImgs: extras, video: document.getElementById('vidUrl').value };
        if(!newItem.title || !newItem.mainImg) { alert("Title and Main Image are required!"); return; }
        let data = JSON.parse(localStorage.getItem('swamiDataPro')) || [];
        if (packageEditIndex === -1) { data.push(newItem); alert("Package Published!"); } 
        else { newItem.id = data[packageEditIndex].id; data[packageEditIndex] = newItem; alert("Package Updated Successfully!"); cancelEdit(); }
        localStorage.setItem('swamiDataPro', JSON.stringify(data)); loadItems(); clearForm();
    }

    function loadItems() {
        const data = JSON.parse(localStorage.getItem('swamiDataPro')) || [];
        const container = document.getElementById('listContainer'); container.innerHTML = '';
        data.forEach((item, index) => { 
            const div = document.createElement('div'); div.className = 'list-item';
            div.innerHTML = `<div><strong>${item.category}</strong>: ${item.title} (₹${item.price})</div><div class="action-btns"><button class="edit-btn" onclick="editItem(${index})">Edit</button><button class="delete-btn" onclick="deleteItem(${index})">Delete</button></div>`;
            container.appendChild(div);
        });
    }

    function editItem(index) {
        let data = JSON.parse(localStorage.getItem('swamiDataPro')) || []; let item = data[index]; packageEditIndex = index;
        document.getElementById('category').value = item.category; document.getElementById('title').value = item.title; document.getElementById('price').value = item.price; document.getElementById('desc').value = item.desc; document.getElementById('imgMain').value = item.mainImg; document.getElementById('vidUrl').value = item.video || '';
        document.querySelectorAll('.extra-img').forEach(i => i.value = ''); 
        if(item.extraImgs) { item.extraImgs.forEach((img, i) => { if(i < 5) document.getElementById('ex'+(i+1)).value = img; }); }
        document.getElementById('formTitle').innerText = "Edit Package: " + item.title; document.getElementById('formTitle').style.color = "#007bff";
        const btn = document.getElementById('submitBtn'); btn.innerText = "UPDATE PACKAGE"; btn.classList.add('update-btn');
        document.getElementById('cancelBtn').style.display = "block"; window.scrollTo(0, 0);
    }

    function cancelEdit() {
        packageEditIndex = -1; clearForm(); document.getElementById('formTitle').innerText = "3. Add New Package / Album"; document.getElementById('formTitle').style.color = "#555";
        const btn = document.getElementById('submitBtn'); btn.innerText = "PUBLISH PACKAGE"; btn.classList.remove('update-btn'); document.getElementById('cancelBtn').style.display = "none";
    }

    function clearForm() { document.getElementById('title').value = ''; document.getElementById('price').value = ''; document.getElementById('desc').value = ''; document.getElementById('imgMain').value = ''; document.getElementById('vidUrl').value = ''; document.querySelectorAll('.extra-img').forEach(i => i.value = ''); }
    function deleteItem(index) { if(confirm("Are you sure?")) { let data = JSON.parse(localStorage.getItem('swamiDataPro')) || []; data.splice(index, 1); localStorage.setItem('swamiDataPro', JSON.stringify(data)); loadItems(); if(index === packageEditIndex) cancelEdit(); }}
    
    window.onload = function() { 
        if(sessionStorage.getItem('swamiAdminAuth') === 'true') {
            document.getElementById('loginOverlay').style.display = 'none';
        }
        loadCategories(); loadItems(); 
    };
</script>
</body>
</html>
