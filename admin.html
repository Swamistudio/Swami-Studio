<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swami Studio | Pro Admin</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        h2 { border-bottom: 2px solid #D4AF37; padding-bottom: 10px; color: #333; margin-top: 0; }
        .section-box { background: #fff; padding: 25px; margin-bottom: 25px; border: 1px solid #e1e4e8; border-radius: 8px; }
        
        label { font-weight: 600; display: block; margin-top: 15px; margin-bottom: 5px; color: #444; }
        input, button, select, textarea { width: 100%; padding: 12px; margin-top: 5px; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; }
        
        button { background: #D4AF37; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; font-size: 16px; }
        button:hover { background: #b59228; }
        .upload-btn { background: #222; }
        .delete-btn { background: #ff4444; width: auto; padding: 5px 10px; float: right; font-size: 12px; margin-left: 10px; }
        
        /* Category Tags */
        .cat-tag { display: inline-block; background: #eee; padding: 5px 10px; border-radius: 20px; margin: 5px; font-size: 14px; }

        /* Login Modal */
        #login-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 999; }
        #login-box { background: white; padding: 40px; width: 320px; text-align: center; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="login-modal">
        <div id="login-box">
            <h2>Admin Login</h2>
            <input type="password" id="admin-pass" placeholder="Password">
            <button onclick="checkLogin()">Login</button>
        </div>
    </div>

    <div class="container" id="admin-panel" style="display:none;">
        <h1 style="text-align:center;">Swami Studio Admin</h1>
        <a href="index.html" target="_blank" style="display:block; text-align:center; margin-bottom:30px; color:#666;">View Live Website ‚Üó</a>

        <div class="section-box" style="background: #fdfdfd; border-left: 5px solid #D4AF37;">
            <h2>üìÇ Manage Categories</h2>
            <p style="color:#666; margin-top:0;">Create categories like "Wedding", "Pre-wedding", "Drone" here.</p>
            
            <div style="display:flex; gap:10px;">
                <input type="text" id="new-cat-name" placeholder="New Category Name">
                <button onclick="addCategory()" style="width:30%; margin-top:5px; background:#333;">Add</button>
            </div>

            <div id="category-list-display" style="margin-top:15px;">
                </div>
        </div>

        <div class="section-box">
            <h2>üì∏ Add New Project / Album</h2>
            
            <label>1. Client Name / Title:</label>
            <input type="text" id="pf-title" placeholder="e.g. Rahul & Priya Wedding">

            <label>2. Select Category:</label>
            <select id="pf-cat-select">
                <option value="">Loading categories...</option>
            </select>

            <label>3. Description:</label>
            <textarea id="pf-desc" placeholder="Write details about the shoot..." style="height:80px;"></textarea>

            <label>4. Main Cover Image (Required):</label>
            <input type="file" id="pf-main-img">

            <label>5. Extra Gallery Images (Optional - Max 5):</label>
            <input type="file" id="pf-sub-imgs" multiple accept="image/*">
            <small style="color:#666;">Hold CTRL to select multiple images.</small>

            <label>6. Video (Optional):</label>
            <input type="file" id="pf-video" accept="video/*">

            <button class="upload-btn" onclick="uploadFullProject()">üöÄ Upload Full Project</button>
            
            <p id="upload-status" style="color:blue; margin-top:15px; font-weight:bold;"></p>
        </div>

        <div class="section-box">
            <h2>üìÖ Bookings</h2>
            <div id="bookings-list">Loading...</div>
        </div>
        
        <div class="section-box">
            <h2>üìù Services</h2>
            <input type="text" id="serv-name" placeholder="Service Name"><input type="number" id="serv-price" placeholder="Price">
            <button onclick="addService()">Add Service</button>
            <div id="services-list" style="margin-top:10px;"></div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // YOUR CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyADXKgZ-y4Oo4BjfGfW7euGLCPp623KE-M",
            authDomain: "swami-studio.firebaseapp.com",
            databaseURL: "https://swami-studio-default-rtdb.firebaseio.com",
            projectId: "swami-studio",
            storageBucket: "swami-studio.firebasestorage.app",
            messagingSenderId: "680267170622",
            appId: "1:680267170622:web:2a489e33c206b72b06e26f",
            measurementId: "G-2K4X9057XG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        // --- AUTH ---
        window.checkLogin = function() {
            if(document.getElementById('admin-pass').value === "admin123") {
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else { alert("Wrong Password"); }
        }

        // --- 1. CATEGORY MANAGER ---
        window.addCategory = function() {
            const name = document.getElementById('new-cat-name').value;
            if(name) {
                push(ref(db, 'categories'), { name: name });
                document.getElementById('new-cat-name').value = "";
            }
        }

        window.deleteCategory = function(id) {
            if(confirm("Delete this category?")) remove(ref(db, 'categories/' + id));
        }

        // Load Categories into List AND Dropdown
        onValue(ref(db, 'categories'), (snap) => {
            const listDiv = document.getElementById('category-list-display');
            const selectBox = document.getElementById('pf-cat-select');
            
            listDiv.innerHTML = "";
            selectBox.innerHTML = "<option value=''>Select Category...</option>";

            if(snap.exists()) {
                snap.forEach(child => {
                    // Update "Manage Categories" List
                    listDiv.innerHTML += `
                        <span class="cat-tag">
                            ${child.val().name} 
                            <a href="#" onclick="deleteCategory('${child.key}')" style="color:red; text-decoration:none; margin-left:5px;">‚úñ</a>
                        </span>`;
                    
                    // Update "Upload" Dropdown
                    selectBox.innerHTML += `<option value="${child.val().name}">${child.val().name}</option>`;
                });
            }
        });

        // --- 2. ADVANCED UPLOAD LOGIC ---
        window.uploadFullProject = async function() {
            const status = document.getElementById('upload-status');
            
            // Get Inputs
            const title = document.getElementById('pf-title').value;
            const category = document.getElementById('pf-cat-select').value;
            const desc = document.getElementById('pf-desc').value;
            const mainFile = document.getElementById('pf-main-img').files[0];
            const subFiles = document.getElementById('pf-sub-imgs').files; // List of files
            const videoFile = document.getElementById('pf-video').files[0];

            if(!mainFile || !category) return alert("Category and Main Image are required!");

            status.innerText = "‚è≥ Starting Upload...";

            try {
                // A. Upload Main Image
                status.innerText = "1/4 Uploading Main Image...";
                const mainSnap = await uploadBytes(sRef(storage, 'projects/' + mainFile.name), mainFile);
                const mainUrl = await getDownloadURL(mainSnap.ref);

                // B. Upload Sub Images (Loop)
                let subUrls = [];
                if(subFiles.length > 0) {
                    status.innerText = `2/4 Uploading ${subFiles.length} Extra Photos...`;
                    for(let i=0; i<subFiles.length; i++) {
                        if(i >= 5) break; // Limit to 5
                        const subSnap = await uploadBytes(sRef(storage, 'projects/' + subFiles[i].name), subFiles[i]);
                        const url = await getDownloadURL(subSnap.ref);
                        subUrls.push(url);
                    }
                }

                // C. Upload Video
                let videoUrl = "";
                if(videoFile) {
                    status.innerText = "3/4 Uploading Video (This may take time)...";
                    const vidSnap = await uploadBytes(sRef(storage, 'projects/' + videoFile.name), videoFile);
                    videoUrl = await getDownloadURL(vidSnap.ref);
                }

                // D. Save Everything to Database
                status.innerText = "4/4 Saving Data...";
                await push(ref(db, 'gallery'), {
                    title: title,
                    category: category,
                    description: desc,
                    mainImage: mainUrl,
                    subImages: subUrls, // Array of URLs
                    video: videoUrl,
                    timestamp: Date.now()
                });

                status.innerText = "‚úÖ Project Uploaded Successfully!";
                alert("Upload Complete!");
                // Reset form
                document.getElementById('pf-title').value = "";
                document.getElementById('pf-desc').value = "";
                document.getElementById('pf-main-img').value = "";
                document.getElementById('pf-sub-imgs').value = "";
                document.getElementById('pf-video').value = "";

            } catch (error) {
                console.error(error);
                status.innerText = "‚ùå Error: " + error.message;
            }
        }

        // --- SERVICES & BOOKINGS (Existing Logic) ---
        window.addService = function() {
            const name = document.getElementById('serv-name').value;
            const price = document.getElementById('serv-price').value;
            if(name && price) push(ref(db, 'services'), { name, price });
        }
        onValue(ref(db, 'services'), (snap) => {
            document.getElementById('services-list').innerHTML = "";
            if(snap.exists()) snap.forEach(c => {
                document.getElementById('services-list').innerHTML += `<div>${c.val().name} - ‚Çπ${c.val().price} <button class="delete-btn" onclick="remove(ref(db, 'services/${c.key}'))">X</button></div>`;
            });
        });
        
        window.remove = remove; window.ref = ref; window.db = db; // Global helper for inline remove

        onValue(ref(db, 'bookings'), (snap) => {
            const list = document.getElementById('bookings-list');
            list.innerHTML = "";
            if(snap.exists()) snap.forEach(c => {
                const b = c.val();
                list.innerHTML += `<div style="background:#eee; padding:10px; margin-bottom:5px;"><strong>${b.name}</strong> (${b.type})<br>${b.date} | ${b.phone} <button class="delete-btn" onclick="remove(ref(db, 'bookings/${c.key}'))">Delete</button></div>`;
            });
        });

    </script>
</body>
</html>
